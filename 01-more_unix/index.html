















<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2022-08-05 00:46:45 -0400">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />
    <link rel="license" href="#license-info" />

    

    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../assets/favicons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/favicons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/favicons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/favicons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../assets/favicons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../assets/favicons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../assets/favicons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../assets/favicons/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../assets/favicons/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../assets/favicons/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../assets/favicons/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/favicons/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../assets/favicons/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="Basic	bioinformatics and command-line	tools	for phytopathologists"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../assets/favicons/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../assets/favicons/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../assets/favicons/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../assets/favicons/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../assets/favicons/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

  <title>
  More UNIX commands &ndash; Basic	bioinformatics and command-line	tools	for phytopathologists
  </title>  

  </head>
  <body>

    <div class="container">
      
















  
  















<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      <a href="" class="pull-left">
        <img class="navbar-logo" src="../assets/logo/icon.svg" alt="Data Carpentry logo" />
      </a>
      

      
      <a class="navbar-brand" href="../">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	      
        <li><a href="../setup.html">Setup</a></li>

        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Lessons <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            
            <li><a href="../01-unix/index.html">UNIX command line</a></li>
            
            
            <li><a href="../02-slurm/index.html">SLURM workload manager</a></li>
            
            
            <li><a href="../03-blast/index.html">BLAST search</a></li>
            
            
            <li><a href="../04-parse/index.html">Parsing BLAST output</a></li>
            
            
            <li><a href="../05-tree/index.html">Phylogenetic tree</a></li>
            
          </ul>
        </li>

        

      

      <li class="dropdown">
        <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Optional <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
            <li><a href="../01-more_unix/index.html">More UNIX commands</a></li>
          
            <li><a href="../02-text_process/index.html">FASTA manipulation with awk</a></li>
          
            <li><a href="../03-extra_tools/index.html">Another bioinformatic tool: PyANI</a></li>
          
            <li><a href="../04-awesome_bioinfo/index.html">Awesome bioinformatics</a></li>
          
            <li><a href="../05-multiple_gene_copies/index.html">Multiple gene copies</a></li>
          
        </ul>
      </li>

      

      <li class="dropdown">
      <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
            <li><a href="../about/">Authors</a></li>
          
            <li><a href="../acknowledgments/">Acknowledgements</a></li>
          
            <li><a href="../faq/index.html">FAQ</a></li>
          
            <li><a href="../intro_slides/index.html">Intro Slides</a></li>
          
        </ul>
      </li>

      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" title="Google search" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>




























  
  
















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../"><span class="glyphicon glyphicon-menu-up" aria-hidden="true"></span><span class="sr-only">lesson home</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
    <h3 class="maintitle"><a href="../">Basic	bioinformatics and command-line	tools	for phytopathologists</a></h3>
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../02-text_process/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">More UNIX commands</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>






<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>To understand UNIX conditional statements.</p>
</li>
	
	<li><p>To learn about functions in bash.</p>
</li>
	
	<li><p>To get started with bash scripting.</p>
</li>
	
	<li><p>Parallelization in bash with GNU parallel.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>The optional sections are targeted for more advanced users 
(psa: more advanced than regular sections, but still for beginners). 
Feel free to try these sections once you are done with regular lesson.</p>

<h2 id="conditionals">Conditionals</h2>

<p>A conditional expression consists of commands that are executed only if some
conditions are satisfied. 
In bash, the general syntax for conditional statement looks like:</p>

<div class="language-plaintext terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ if [ condition ]
  then
      commands if given condition is true ...
      ...
  elif [ another condition]
      commands if new condition is true but previous conditions are false ...
      ...
  else
      commands if all conditions is false ...
      ...
  fi
</code></pre></div></div>

<blockquote class="notes">
  <p><code class="language-plaintext highlighter-rouge">elif</code> and <code class="language-plaintext highlighter-rouge">else</code> sections are optional. 
<code class="language-plaintext highlighter-rouge">elif</code> section can be repeated multiple times.</p>
</blockquote>

<p>Let’s look at a simple example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span><span class="k">if</span> <span class="o">[</span> 1&lt;2 <span class="o">]</span>
  <span class="k">then
      </span><span class="nb">echo</span> <span class="s2">"true"</span>
  <span class="k">else
      </span><span class="nb">echo</span> <span class="s2">"false"</span>
  <span class="k">fi</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>true
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span><span class="k">if</span> <span class="o">[</span> 1&gt;2 <span class="o">]</span>
  <span class="k">then
      </span><span class="nb">echo</span> <span class="s2">"true"</span>
  <span class="k">else
      </span><span class="nb">echo</span> <span class="s2">"false"</span>
  <span class="k">fi</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>false
</code></pre></div></div>

<h3 id="operators">Operators</h3>

<p>Instead of commonly used operator symbols such as <code class="language-plaintext highlighter-rouge">=</code> or <code class="language-plaintext highlighter-rouge">&gt;=</code>, 
it is preferable to use test operators for numeric comparisons, 
especially when working with variables that have not been declared as numbers.</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">-eq</code> for <strong>equal to</strong>,</li>
  <li><code class="language-plaintext highlighter-rouge">-gt</code> for <strong>greater than</strong></li>
  <li><code class="language-plaintext highlighter-rouge">-lt</code> for <strong>greater than</strong>,</li>
  <li><code class="language-plaintext highlighter-rouge">-ge</code> for <strong>greater than or equal to</strong></li>
  <li><code class="language-plaintext highlighter-rouge">-le</code> for <strong>less than or equal to</strong></li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span><span class="nv">a</span><span class="o">=</span>1

<span class="gp">$ </span><span class="nv">b</span><span class="o">=</span>2

<span class="gp">$ </span><span class="k">if</span> <span class="o">[</span> <span class="nv">$a</span> <span class="nt">-gt</span> <span class="nv">$b</span> <span class="o">]</span>
  <span class="k">then
      </span><span class="nb">echo</span> <span class="s2">"a is greater than b."</span>
  <span class="k">elif</span> <span class="o">[</span> <span class="nv">$a</span> <span class="nt">-lt</span> <span class="nv">$b</span> <span class="o">]</span>
      <span class="nb">echo</span> <span class="s2">"a is lesser than b."</span>
  <span class="k">else
      </span><span class="nb">echo</span> <span class="s2">"a is equal to b."</span>
  <span class="k">fi</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>a is lesser than b.
</code></pre></div></div>

<p>Other useful operators are</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">!condition</code> for checking if the condition is false.</li>
  <li><code class="language-plaintext highlighter-rouge">-z STRING</code> for checking if string (or variable) is empty.</li>
  <li><code class="language-plaintext highlighter-rouge">-v VARIABLE</code> for checking if variable is defined.</li>
  <li><code class="language-plaintext highlighter-rouge">-d /path/to/DIR</code> for checking if a directory exists.</li>
  <li><code class="language-plaintext highlighter-rouge">-f /path/to/FILE</code> for checking if a file exists.</li>
  <li><code class="language-plaintext highlighter-rouge">-s /path/to/FILE</code> for checking if a file exists and is not empty.</li>
</ul>

<h3 id="single-line-conditional-statement">Single line conditional statement</h3>

<p>For shorter commands, conditional statements can be written as one-liner
using double brackets <code class="language-plaintext highlighter-rouge">[[...]]</code>.</p>

<p>The general syntax is:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span><span class="o">[[</span> CONDITION <span class="o">]]</span> <span class="o">&amp;&amp;</span> COMMANDS IF TRUE <span class="o">||</span> COMMANDS IF FALSE
</code></pre></div></div>

<p>Let’s look at some examples.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">ls </span>files/fasta
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>example.fasta
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span><span class="o">[[</span> <span class="nt">-f</span> files/demo/example.txt <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"file exists"</span><span class="nb">.</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code></code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span><span class="o">[[</span> <span class="nt">-f</span> files/demo/example.txt <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"file exists"</span> <span class="o">||</span> <span class="nb">echo</span> <span class="s2">"file does not exist"</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>file does not exist
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span><span class="o">[[</span> <span class="nt">-f</span> files/demo/example.fasta <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"file exists"</span> <span class="o">||</span> <span class="nb">echo</span> <span class="s2">"file does not exist"</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>file exists
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span><span class="o">[[</span> <span class="o">!</span> <span class="nt">-f</span> files/demo/example.fasta <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"file exists"</span> <span class="o">||</span> <span class="nb">echo</span> <span class="s2">"file does not exist"</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>file does not exist
</code></pre></div></div>

<h2 id="an-intro-to-functions">An intro to functions</h2>

<p>Functions are scoped, reusable and often portable chunks of code.
Reusability is an important aspect to a function, 
as you can refer back to the same piece of code multiple times throughout
your pipeline once you define it once.</p>

<h3 id="function-syntax">Function syntax</h3>

<p>In bash, functions are defined as follows:</p>

<div class="language-plaintext terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ function_name () 
  {
      function code ...
      ...
  }
</code></pre></div></div>

<blockquote class="tips">
  <p><code class="language-plaintext highlighter-rouge">function_name</code> is the name of the function, and it will be used to call the function later.</p>

  <p><code class="language-plaintext highlighter-rouge">()</code> declares the variable <code class="language-plaintext highlighter-rouge">function_name</code> stores a function, 
rather than string or another data.</p>

  <p><code class="language-plaintext highlighter-rouge">{...}</code> delimits the scope of the function, i.e., it encloses the code that are
part of the function.</p>
</blockquote>

<p>Let’s write a simple function.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span>myfunc <span class="o">()</span>
  <span class="o">{</span>
      <span class="nb">echo</span> <span class="s2">"Hello, world!"</span>
  <span class="o">}</span>
</code></pre></div></div>

<h3 id="calling-a-function">Calling a function</h3>

<p>As mentioned earlier, a function is called by its name. 
Let’s call the <code class="language-plaintext highlighter-rouge">myfunc</code> function defined earlier.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span>myfunc
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hello, world!
</code></pre></div></div>

<p>The code <code class="language-plaintext highlighter-rouge">echo ...</code> was executed when you called the function.</p>

<h3 id="arguments">Arguments</h3>

<p>Another important component of functions are arguments. 
Arguments are values passed to the function
from interactive prompt or from parent script. 
Arguments enable the function to use different input data in different calls.</p>

<p>You can pass arguments to a function by simply 
supplying the values after the function name. 
The function stores the arguments passed to it in variables 
$1 (first argument), $2 (second argument), … and so on.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span>myfunc2<span class="o">()</span>
  <span class="o">{</span>
      <span class="nb">echo</span> <span class="nv">$1</span>
      <span class="nb">echo</span> <span class="nv">$2</span>
  <span class="o">}</span>

<span class="gp">$ </span>myfunc2 <span class="s2">"Hello"</span> <span class="s2">"World"</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hello
World
</code></pre></div></div>

<p>Let’s call the function with new arguments.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span>myfunc2<span class="o">()</span>
  <span class="o">{</span>
      <span class="nb">echo</span> <span class="nv">$1</span>
      <span class="nb">echo</span> <span class="nv">$2</span>
  <span class="o">}</span>

<span class="gp">$ </span>myfunc2 <span class="s2">"This workshop"</span> <span class="s2">"is awesome."</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>This workshop
is awesome.
</code></pre></div></div>

<blockquote class="notes">
  <h2 id="return-value">Return value</h2>

  <p>Unlike many other programming languages,
bash function do not return a data back,
but rather return a status.</p>

  <p>Instead values can be saved to a global variable or a file.
This part will not be discussed here.</p>

  <p>Alternatively, standard output, e.g., <code class="language-plaintext highlighter-rouge">echo</code>, can be captured as follows.</p>

  <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">echo</span> <span class="si">$(</span>myfunc2<span class="si">)</span> | <span class="nb">wc</span> <span class="nt">-c</span>

<span class="gp">$ </span><span class="nb">wc</span> <span class="nt">-c</span> <span class="o">&lt;&lt;&lt;</span> <span class="si">$(</span>myfunc2<span class="si">)</span>
</code></pre></div>  </div>

</blockquote>

<blockquote class="challenge">
  <h2 id="exercise-write-your-own-script">Exercise: Write your own script</h2>

  <ol>
    <li>Write a function to find the maximum of two input numbers.</li>
    <li>Run the function with 1 and 2.</li>
    <li>Run the function with 4 and 3.</li>
  </ol>

  <details>
    <summary></summary>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1</span>
<span class="gp">$ </span>max_num<span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nv">$1</span> <span class="nt">-gt</span> <span class="nv">$2</span> <span class="o">]</span>
    <span class="k">then
        </span><span class="nb">echo</span> <span class="nv">$1</span>
    <span class="k">else
        </span><span class="nb">echo</span> <span class="nv">$2</span>
    <span class="k">fi</span>
  <span class="o">}</span>

<span class="c">#1 alternative one-liner</span>
<span class="gp">$ </span>max_num<span class="o">()</span> <span class="o">{</span>
    <span class="o">[[</span> <span class="nv">$1</span> <span class="nt">-gt</span> <span class="nv">$2</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="nv">$1</span> <span class="o">||</span> <span class="nb">echo</span> <span class="nv">$2</span>
  <span class="o">}</span>
</code></pre></div>    </div>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 2</span>
<span class="gp">$ </span>max_num 1 2
</code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2
</code></pre></div>    </div>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 3</span>
<span class="gp">$ </span>max_num 4 3
</code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>4
</code></pre></div>    </div>
  </details>
</blockquote>

<h2 id="an-intro-to-scripting">An intro to scripting</h2>

<p>Scripts are another way of writing reusable portable code.
Scripts are files which contain code to be executed and 
are called interactively or from another script.</p>

<p>Scripts are generally considered more standalone than functions.
Scripts are preferrable to functions when the code is reused in
many other scripts.</p>

<h3 id="writing-a-script">Writing a script</h3>

<p>A typical UNIX script looks like this:</p>

<div class="language-plaintext terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/sh

your code here ...
...
</code></pre></div></div>

<blockquote class="tips">
  <h2 id="script-shell">Script shell</h2>
  <p>The first line of a script is a shebang, i.e., <code class="language-plaintext highlighter-rouge">#!</code> , 
followed by the shell to run the script.</p>

  <p>A shell is an interpreter, which converts user command to machine language.</p>
  <ul>
    <li>The Bourne shell <code class="language-plaintext highlighter-rouge">sh</code> is available in all modern UNIX systems 
and is available from path <code class="language-plaintext highlighter-rouge">/bin/sh</code>.</li>
    <li>The Bourne-Again shell <code class="language-plaintext highlighter-rouge">bash</code> is present in most modern UNIX systems 
and is the default shell in many of them. 
It is <a href="https://www.gnu.org/software/bash/manual/html_node/Major-Differences-From-The-Bourne-Shell.html">slightly feature rich</a> than <code class="language-plaintext highlighter-rouge">sh</code> and 
is available from path <code class="language-plaintext highlighter-rouge">/bin/bash</code>.</li>
    <li><code class="language-plaintext highlighter-rouge">zsh</code>, <code class="language-plaintext highlighter-rouge">fish</code>, <code class="language-plaintext highlighter-rouge">ksh</code>, <code class="language-plaintext highlighter-rouge">dash</code> etc. are other popular UNIX shells.</li>
    <li>Many programming languages provide their shells. 
For example, python scripts can be run from <code class="language-plaintext highlighter-rouge">/usr/bin/env python</code> or 
<code class="language-plaintext highlighter-rouge">/usr/bin/env python3</code> etc. and R scripts from <code class="language-plaintext highlighter-rouge">/usr/bin/env Rscript</code>.</li>
  </ul>

  <p>If you are not sure about shell selection, 
<code class="language-plaintext highlighter-rouge">bash</code> is the safest choice for UNIX scripting.</p>
</blockquote>

<p>Let’s write a simple script. 
Use <a href="/02-slurm/#adding-information-to-slurm-script"><code class="language-plaintext highlighter-rouge">nano</code></a> to write a simple script as follows. 
Once you are done, press <kbd>Ctrl</kbd>+<kbd>x</kbd> to return to bash prompt.
Press <kbd>Y</kbd> and <kbd>Enter</kbd> to save the changes made to the file.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span>nano code.sh
</code></pre></div></div>

<div class="language-plaintext terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-----------------------------------------------------------------------------------------------
 GNU nano 3.3 beta 02                     File: code.sh
-----------------------------------------------------------------------------------------------
#!/bin/bash

echo "Hello, World!"




-----------------------------------------------------------------------------------------------
^G Get Help     ^O WriteOut     ^R Read File     ^Y Prev Page     ^K Cut Text       ^C Cur Pos
^X Exit         ^J Justify      ^W Where Is      ^V Next Page     ^U UnCut Text     ^T To Spell
-----------------------------------------------------------------------------------------------
</code></pre></div></div>

<h3 id="making-script-executable">Making script executable</h3>

<p>So far, your script is a regular text file and does not have <strong>execution</strong> permission.
You can make it executable by using <code class="language-plaintext highlighter-rouge">chmod +x</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">chmod</span> +x code.sh
</code></pre></div></div>

<h3 id="calling-the-script">Calling the script</h3>

<p>You can run the script by using its filepath (path+filename).</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span>./code.sh
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hello, World!
</code></pre></div></div>

<h3 id="arguments-1">Arguments</h3>

<p>Just like functions, arguments to a script can be passed by simply 
supplying the values after the call.</p>

<p>Similarly, argument values can be accessed from within script with 
$1, $2 and so on.</p>

<blockquote class="notes">
  <h2 id="parsing-the-argument">Parsing the argument</h2>

  <p>Argument parsing in a script allows</p>
  <ul>
    <li>passing arguments without a fixed order</li>
    <li>pass options without any arguments</li>
  </ul>

  <p>An example is <code class="language-plaintext highlighter-rouge">echo -h</code> for help, where <code class="language-plaintext highlighter-rouge">-h</code> is an option.</p>

  <p>We do not cover argument parsing here, but you can learn more about it 
<a href="https://www.shellscript.sh/tips/getopts/">here</a>.</p>
</blockquote>

<blockquote class="tips">
  <p>If you are publishing your own script for others to use, 
it is considered best practice to adequately comment each step of the script.</p>
</blockquote>

<blockquote class="challenge">
  <h2 id="exercise-write-your-own-script-1">Exercise: Write your own script</h2>

  <ol>
    <li>
      <p>Use what you learnt so far to write a script that does the following:<br />
 a) Create a directory named in the first argument in current directory.  <input type="checkbox" /><br />
 b) Create a file that named in the second argument within directory from step 1.  <input type="checkbox" /><br />
 c) Write the content of third argument to the file from step 2.  <input type="checkbox" /><br />
 d) Print content of file created in step 2.  <input type="checkbox" /></p>
    </li>
    <li>
      <p>Next, run the script with following arguments:</p>
      <ul>
        <li>first argument: demo</li>
        <li>second argument: text</li>
        <li>third argument: “Success!”</li>
      </ul>
    </li>
  </ol>

  <details>
    <summary></summary>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1</span>
nano script.sh
</code></pre></div>    </div>

    <div class="language-plaintext terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code>------------------------------------------------------------------------------------------
 GNU nano 3.3 beta 02                   File: script.sh
------------------------------------------------------------------------------------------
#!/bin/bash

# 1a - creating a directory from first argument
mkdir -p $1

# 1b - creating a file from second argument within the directory
touch $1/$2

# 1c - writing third argument to the file created
echo $3 &gt; $1/$2

# 1d - reading the content of the file
cat $1/$2

------------------------------------------------------------------------------------------
^G Get Help    ^O WriteOut    ^R Read File    ^Y Prev Page    ^K Cut Text      ^C Cur Pos
^X Exit        ^J Justify     ^W Where Is     ^V Next Page    ^U UnCut Text    ^T To Spell
------------------------------------------------------------------------------------------
</code></pre></div>    </div>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 2</span>
<span class="gp">$ </span><span class="nb">chmod</span> +x <span class="nv">$1</span>/<span class="nv">$2</span>     <span class="c"># making script executable</span>
<span class="gp">$ </span>./script.sh demo text <span class="s2">"Success!"</span>
</code></pre></div>    </div>

    <div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Success!
</code></pre></div>    </div>

    <blockquote class="tips">
      <p>Using <code class="language-plaintext highlighter-rouge">-p</code> argument with <code class="language-plaintext highlighter-rouge">mkdir</code> eliminates errors related to creating 
 nested or pre-existing directories.</p>
    </blockquote>

  </details>
</blockquote>

<h2 id="parallelization">Parallelization</h2>

<p>In computer science, parallelization is the execution of multiple, 
often similar/repeated tasks concurrently.</p>

<p>Parallelization is important in bioinformatics because of:</p>
<ul>
  <li>large dataset leading to lengthy computation time, e.g., 50 million reads, 30 Gb file</li>
  <li>similar processing for each unit of data, e.g., alignment of each read to reference genome using identical processes.</li>
  <li>availability of computing clusters with large computing resources.</li>
</ul>

<p>Let’s look at a demo example of parallelization using <a href="https://www.gnu.org/software/parallel/">GNU parallel</a>.</p>

<p>First let’s define function that takes some time to complete.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span>myfunc3<span class="o">()</span>
  <span class="o">{</span>
    <span class="nb">sleep </span>2   <span class="c"># suspend computing for 2 seconds</span>
    <span class="nb">echo</span> <span class="nv">$1</span>
  <span class="o">}</span>
</code></pre></div></div>

<p>We can execute this n times function sequentially, i.e., not in parallel using a for loop.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span><span class="k">for </span>i <span class="k">in</span> <span class="o">{</span>1..10<span class="o">}</span><span class="p">;</span> <span class="k">do </span>myfunc3 <span class="nv">$1</span><span class="p">;</span> <span class="k">done</span>
</code></pre></div></div>

<p>We need some way to monitor the time taken. Let use some simple math for this, 
i.e., subtract start time from end time.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span><span class="nv">start</span><span class="o">=</span><span class="nv">$SECONDS</span>   <span class="c"># Start time</span>
<span class="gp">$ </span><span class="k">for </span>i <span class="k">in</span> <span class="o">{</span>1..10<span class="o">}</span><span class="p">;</span> <span class="k">do </span>myfunc3 <span class="nv">$i</span><span class="p">;</span> <span class="k">done</span>
<span class="gp">$ </span><span class="nv">end</span><span class="o">=</span><span class="nv">$SECONDS</span>     <span class="c"># End time</span>
<span class="gp">$ </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"---</span><span class="se">\n</span><span class="s2">Execution time is </span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$end</span><span class="s2"> - </span><span class="nv">$start</span><span class="s2">"</span> | bc <span class="nt">-l</span><span class="si">)</span><span class="s2"> seconds."</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1
2
3
4
5
6
7
8
9
10
---
Execution time is 20 seconds.
</code></pre></div></div>

<p>Now let us parallelize.</p>

<h2 id="parallelization-with-background-tasks">Parallelization with background tasks</h2>

<p>The easiest way to parallelize is bash is by using background task. 
This is accomplished using <code class="language-plaintext highlighter-rouge">&amp;</code> at the end of the command (within loop).</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">set</span> +m           <span class="c"># Disable monitoring mode to prevent job status output</span>
<span class="gp">$ </span><span class="nv">start</span><span class="o">=</span><span class="nv">$SECONDS</span>   <span class="c"># Start time</span>
<span class="gp">$ </span><span class="k">for </span>i <span class="k">in</span> <span class="o">{</span>1..10<span class="o">}</span><span class="p">;</span> <span class="k">do </span>myfunc3 <span class="nv">$i</span> &amp; <span class="k">done</span>
<span class="gp">$ </span><span class="nb">wait</span>             <span class="c"># Wait for all tasks to complete</span>
<span class="gp">$ </span><span class="nv">end</span><span class="o">=</span><span class="nv">$SECONDS</span>     <span class="c"># End time</span>
<span class="gp">$ </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"---</span><span class="se">\n</span><span class="s2">Execution time is </span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$end</span><span class="s2"> - </span><span class="nv">$start</span><span class="s2">"</span> | bc <span class="nt">-l</span><span class="si">)</span><span class="s2"> seconds."</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1
2
3
4
5
6
7
8
9
10
---
Execution time is 2 seconds.
</code></pre></div></div>

<blockquote class="notes">
  <p>Your screen output might look slightly different. 
The background task management in RedHat Linux (used by HiperGator)
prints some more job id information on the screen. 
Nonetheless, output of <code class="language-plaintext highlighter-rouge">myfunc3</code> function should be same as above.</p>
</blockquote>

<h2 id="gnu-parallel">GNU parallel</h2>

<p>However, inbuilt parallelization methods in UNIX system are not
very user-intuitive and flexible, and sometime vary slightly between different
UNIX distros. GNU <code class="language-plaintext highlighter-rouge">parallel</code> is a great alternative for parallelization.
Among other benefits, it can set number of CPU cores per job based on number of jobs
and has options to specify minimum memory for a job,
which make sit a useful tool in bioinformatics.</p>

<p>In a personal computer,
parallel needs to be installed <a href="https://ftp.gnu.org/gnu/parallel/">source</a>. 
However, GNU <code class="language-plaintext highlighter-rouge">parallel</code> is available in HiperGator –
it only needs to be loaded.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span>ml parallel
</code></pre></div></div>

<p>User-defined objects (variables and functions) are not accessible 
within parallel by default,
so the function <code class="language-plaintext highlighter-rouge">myfunc3</code> has to be made global (globally available) first.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">export</span> <span class="nt">-f</span> myfunc3
</code></pre></div></div>

<p>Now, let’s run 5 jobs at the same time.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span><span class="nv">start</span><span class="o">=</span><span class="nv">$SECONDS</span>   <span class="c"># Start time</span>
<span class="gp">$ </span>parallel <span class="nt">-j5</span> <span class="nt">--ungroup</span> <span class="nt">--will-cite</span> myfunc3 ::: <span class="o">{</span>1..10<span class="o">}</span>
<span class="gp">$ </span><span class="nv">end</span><span class="o">=</span><span class="nv">$SECONDS</span>     <span class="c"># End time</span>
<span class="gp">$ </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"---</span><span class="se">\n</span><span class="s2">Execution time is </span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$end</span><span class="s2"> - </span><span class="nv">$start</span><span class="s2">"</span> | bc <span class="nt">-l</span><span class="si">)</span><span class="s2"> seconds."</span>
</code></pre></div></div>

<blockquote class="notes">
  <h2 id="breakdown-of-gnu-parallel">Breakdown of GNU parallel</h2>
  <ul>
    <li><code class="language-plaintext highlighter-rouge">parallel</code> is the command name.</li>
    <li><code class="language-plaintext highlighter-rouge">-j5</code> specifies 5 jobs at a time.</li>
    <li><code class="language-plaintext highlighter-rouge">--ungroup</code> specifies printing output as soon as one input is processed (optional).</li>
    <li><code class="language-plaintext highlighter-rouge">--will-cite</code> is added to suppress prompt to cite parallel (optional).</li>
    <li><code class="language-plaintext highlighter-rouge">myfunc3</code> is the function to execute.</li>
    <li><code class="language-plaintext highlighter-rouge">{1..10}</code> is an array of 10 arguments.</li>
  </ul>

  <p>The function <code class="language-plaintext highlighter-rouge">myfunc3</code> will be run 10 time,
each with a number between 1 to 10 as an argument.</p>
</blockquote>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1
2
3
4
5
6
7
8
9
10
---
Execution time is 5 seconds.
</code></pre></div></div>

<p>Thus, with parallelization, we were able to reduce the execution time.</p>

</article>



























  
  
















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../"><span class="glyphicon glyphicon-menu-up" aria-hidden="true"></span><span class="sr-only">lesson home</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../02-text_process/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      
<footer>
  <hr/>
  <div class="row">
    <div class="col-md-6" align="left">
      <h4>
	      Copyright &copy; 2020–2022 <a href="https://github.com/BioInfoAPS">APS Basic Bioinformatics Workshop Team</a>
    </div>
  </div>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>

<script>
/* Based on https://stackoverflow.com/a/30894829/1802726 */
var show_instructions = function() {
     //set all nav tabs to inactive
    $('.nav-tabs li').removeClass('active');

    //get all nav tabs matching the os and set to active
    $('.nav-tabs li a[href*="'+localStorage.os+'"]').closest('li').addClass('active');

    //set all tabs to inactive
    $('.tab-pane').removeClass('active');

    //get all tabs matching the os and set to active
    $('.tab-pane[id*="'+localStorage.os+'"]').addClass('active');
}

if (typeof(Storage) !== "undefined") {
    if (localStorage.os == "undefined") {
        localStorage.os = "windows";
    }
    show_instructions();
} else {
    console.log("No localStorage");
}

/* Based on https://stackoverflow.com/a/30894829/1802726 */
$('.nav-tabs li a').click(function(){
    //get selected os
    localStorage.os = $(this)[0].dataset.os;
    show_instructions();
});

  // detect misssing iframe for Eventbrite
  $(document).ready(function(){
      if ($('iframe').height() == 0) {
          $('iframe').before('<p>Looks like your adblocker blocked the registration window. Please navigate to <a href="https://www.eventbrite.com/tickets-external?eid=&ref=etckt">https://www.eventbrite.com/tickets-external?eid=&ref=etckt</a> to register.</p>');
      }
  });

  // hide alerts when site is rendered on carpentries.github.io
  $(document).ready(function() {
      if (location.href.startsWith("https://carpentries.github.io/workshop-template/")) {
          $("div.alert").hide();
      }
  });

</script>

  </body>
</html>
