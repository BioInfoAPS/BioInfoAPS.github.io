















<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2022-10-17 15:07:32 -0400">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="https://bioinfoaps.github.io/">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />
    <link rel="license" href="#license-info" />

    

    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../assets/favicons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/favicons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/favicons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/favicons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../assets/favicons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../assets/favicons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../assets/favicons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../assets/favicons/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../assets/favicons/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../assets/favicons/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../assets/favicons/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/favicons/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../assets/favicons/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="Basic	bioinformatics and command-line	tools	for phytopathologists"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../assets/favicons/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../assets/favicons/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../assets/favicons/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../assets/favicons/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../assets/favicons/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

  <title>
  SLURM workload manager &ndash; Basic	bioinformatics and command-line	tools	for phytopathologists
  </title>  

  </head>
  <body>

    <div class="container">
      
















  
  















<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      <a href="" class="pull-left">
        <img class="navbar-logo" src="../assets/logo/icon.svg" alt="Data Carpentry logo" />
      </a>
      

      
      <a class="navbar-brand" href="../">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	      
        <li><a href="../setup.html">Setup</a></li>

        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Lessons <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            
            <li><a href="../01-unix/index.html">UNIX command line</a></li>
            
            
            <li><a href="../02-slurm/index.html">SLURM workload manager</a></li>
            
            
            <li><a href="../03-blast/index.html">BLAST search</a></li>
            
            
            <li><a href="../04-parse/index.html">Parsing BLAST output</a></li>
            
            
            <li><a href="../05-tree/index.html">Phylogenetic tree</a></li>
            
          </ul>
        </li>

        

      

      <li class="dropdown">
        <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Optional <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
            <li><a href="../10-more_unix/index.html">More UNIX commands</a></li>
          
            <li><a href="../20-text_process/index.html">FASTA manipulation with awk</a></li>
          
            <li><a href="../30-extra_tools/index.html">Another bioinformatic tool: PyANI</a></li>
          
            <li><a href="../40-awesome_bioinfo/index.html">Awesome bioinformatics</a></li>
          
            <li><a href="../50-multiple_gene_copies/index.html">Multiple gene copies</a></li>
          
        </ul>
      </li>

      

      <li class="dropdown">
      <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
            <li><a href="../about/">About</a></li>
          
            <li><a href="../acknowledgments/">Acknowledgements</a></li>
          
            <li><a href="../faq/index.html">FAQ</a></li>
          
            <li><a href="../intro_slides/index.html">Intro Slides</a></li>
          
        </ul>
      </li>

      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" title="Google search" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>




























  
  
















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../01-unix/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
    <h3 class="maintitle"><a href="../">Basic	bioinformatics and command-line	tools	for phytopathologists</a></h3>
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../03-blast/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">SLURM workload manager</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>












<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 10 min
      <br/>
      <strong>Exercises:</strong> 15 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I submit job to the cluster computer?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Run the unix command in HiPerGator</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>Unlike a personal computer, a computation cluster is used by large number 
of users to run resource intensive jobs. 
The sum of the resources requested by 
those jobs often exceed the resources available in cluster. 
To deal with this issue, many high performance clusters use schedulers 
to manage resources allocated to those jobs.</p>

<p><a href="https://www.rc.ufl.edu/services/hipergator/" target="_blank">UF Hipergator</a> 
uses a popular scheduler called 
<a href="https://slurm.schedmd.com/documentation.html" target="_blank">SLURM</a> 
workload manager.<br />
<a href="https://www.openpbs.org/" target="_blank">Portable Batch System (PBS)</a>, 
<a href="https://adaptivecomputing.com/cherry-services/moab-hpc/" target="_blank">MOAB</a>, 
<a href="https://www.ibm.com/products/z-workload-scheduler" target="_blank">Workload Scheduler</a> etc. 
are examples of other schedulers.</p>

<p>SLURM has three major functions:</p>

<ol>
  <li>Allocate exclusive and/or non-exlcudisve access to resources 
for a duration of time so they can perform a work,</li>
  <li>Provide a framework for starting, executing, and monitoring work on allocated nodes,</li>
  <li>Arbitrate contention for resources by managing a queue of pending work.</li>
</ol>

<p>Advantage of using (SLURM) scheduler:</p>
<ol>
  <li>Once resources are allocated to a job, they are not taken away until job exits. 
If someone runs intensive job at the same time, 
the resources available to the job is not changed. 
This improves speed and reliability of job completion.</li>
  <li>It allows low priority resource-intesive jobs to run ouside peak hours.</li>
  <li>Unlike interactive window, SLURM jobs do not stop when user is not logged in.</li>
</ol>

<h3 id="slurm-scripts">SLURM scripts</h3>

<p>In order to submit a job, user must provide a scripts that will specify user, 
account, time limit, memory, job output, and other information.
A common way to do this is to create a submission script. 
A submission script, like other bash scripts, 
contains all the commands to be run during the job. 
However, it also contains extra comments which can be read by SLURM 
to determine resource requests.</p>

<p>To get started with SLURM, lets create new directory in your work directory and 
copy a submission script template from share/scripts directory.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">cd</span> /blue/general_workshop/&lt;username&gt;

<span class="gp">$ </span><span class="nb">mkdir </span>slurm

<span class="gp">$ </span><span class="nb">cd </span>slurm

<span class="gp">$ </span><span class="nb">cp</span> ../../share/scripts/slurm_template.sh ./slurm.sh
</code></pre></div></div>

<p>Note: <code class="language-plaintext highlighter-rouge">.sh</code> is commonly used extension for shell scripts. Using a extension is not mandatory.</p>

<h3 id="adding-information-to-slurm-script">Adding information to SLURM script</h3>

<p>We have to modify some information in the template to make the provide more information
to SLURM about the job.</p>

<p>We can use a small text editor program called <code class="language-plaintext highlighter-rouge">nano</code> for writing to a file.
This will open a basic text editor.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span>nano slurm.sh
</code></pre></div></div>

<div class="language-plaintext terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-----------------------------------------------------------------------------------------------
 GNU nano 3.3 beta 02                     File: slurm.sh
-----------------------------------------------------------------------------------------------
#!/bin/bash
#
#SBATCH --job-name serial_job_test    # Job name
#SBATCH --account general_workshop    # Account to run the computational task
#SBATCH --qos general_workshop        # Account allocation
#SBATCH --mail-type END,FAIL          # Mail events (NONE, BEGIN, END, FAIL, ALL)
#SBATCH --mail-user &lt;email_address&gt;   # Where to send mail  
#SBATCH --ntasks 1                    # Run on a single CPU
#SBATCH --mem 10mb                    # Job memory request
#SBATCH --time 00:05:00               # Time limit hrs:min:sec
#SBATCH --output serial_test_%j.log   # Standard output and error log

# Return current date and time every 10 seconds for 6 times
for i in {0..5}; do printf '%s %s\n' "$(date)"; sleep 10s; done


-----------------------------------------------------------------------------------------------
^G Get Help     ^O WriteOut     ^R Read File     ^Y Prev Page     ^K Cut Text       ^C Cur Pos
^X Exit         ^J Justify      ^W Where Is      ^V Next Page     ^U UnCut Text     ^T To Spell
-----------------------------------------------------------------------------------------------
</code></pre></div></div>

<p>The comments beginning with <code class="language-plaintext highlighter-rouge">#SBATCH</code> tell SLURM various information about the job.
The acutal commands to run appear after these comments. In this case, it just returns
current datetime at 10s interval.</p>

<blockquote class="tips">
  <h2 id="waiting-in-bash">Waiting in bash</h2>
  <p>To halt the execution of commands for certain period of time, 
<code class="language-plaintext highlighter-rouge">wait</code> command is used followed by the period of time.</p>
</blockquote>

<p>Change the &lt;email_address&gt; to your email address where you can check email.
Once you are done, press <kbd>Ctrl</kbd>+<kbd>x</kbd> to return to bash prompt.
Press <kbd>Y</kbd> and <kbd>Enter</kbd> to save the changes made to the file.</p>

<blockquote class="caution">
  <h2 id="editing-in-nano">Editing in nano</h2>
  <p><strong>nano</strong> is a commandline editor. You can only move your cursor with 
arrow keys: <kbd>↑</kbd>, <kbd>↓</kbd>, <kbd>←</kbd> and <kbd>→</kbd>.
Clicking with mouse does not change the position of the cursor. 
Be careful, you may be editing in wrong place.</p>

  <p>If you accidentally edited in wrong place, exit nano, 
delete the script <code class="language-plaintext highlighter-rouge">slurm.sh</code> and copy again from share directory.
Do not forget to edit the &lt;email_address&gt;.</p>
</blockquote>

<h2 id="running-a-job-in-slurm">Running a job in SLURM</h2>

<h3 id="submitting-a-slurm-job">Submitting a SLURM job</h3>

<p>To submit the job to SLURM, <code class="language-plaintext highlighter-rouge">sbatch</code> command is used.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span>sbatch slurm.sh 
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Submitted batch job &lt;jobid&gt;
</code></pre></div></div>

<h3 id="checking-status-of-a-slurm-job">Checking status of a SLURM job</h3>

<p>You can check the status of the job using the command <code class="language-plaintext highlighter-rouge">squeue</code>. 
<code class="language-plaintext highlighter-rouge">-u</code> argument accepts &lt;username&gt; and displays all jobs by the user.
<code class="language-plaintext highlighter-rouge">-A</code> argument accepts account name and displays all jobs 
using the resources allocated to that account.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span>squeue <span class="nt">-u</span> &lt;username&gt; 
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
  &lt;jobid&gt; hpg2-comp serial_j   &lt;user&gt;  R       0:07      1 c29a-s2
</code></pre></div></div>

<blockquote class="tips">
  <p>If you do not see your job, it may have already been completed.
Run the job again and check within a minute.
Also, check your email to see if you received any messages from HiperGator.</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span>squeue <span class="nt">-A</span> general_workshop
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    JOBID PARTITION     NAME      USER  ST       TIME  NODES NODELIST(REASON)
  &lt;jobid&gt; hpg2-comp serial_j   &lt;user1&gt;  PD       0:00      1 c29a-s2
  &lt;jobid&gt; hpg2-comp serial_j   &lt;user2&gt;   R       1:12      1 c15a-s1
  &lt;jobid&gt; hpg2-comp serial_j   &lt;user3&gt;   R       0:46      1 c09a-s4
</code></pre></div></div>

<blockquote class="tips">
  <h2 id="understanding-job-status">Understanding Job Status</h2>
  <p>Under status <code class="language-plaintext highlighter-rouge">ST</code>, <code class="language-plaintext highlighter-rouge">R</code> stands for Running and <code class="language-plaintext highlighter-rouge">PD</code> stands for pending.
If the job is pending, a reason may be provided in last column. Eg:</p>
  <ul>
    <li><strong>None</strong>: Just taking a while before running.</li>
    <li><strong>Priority</strong>: Higher priority jobs exist in this partition.</li>
    <li><strong>QOSMaxCpuPerUserLimit</strong>: The user is already using max 
number of CPU that they are allowed to use.</li>
  </ul>
</blockquote>

<h3 id="checking-the-output">Checking the output</h3>

<p>The SLURM submission script containas a line 
<code class="language-plaintext highlighter-rouge">#SBATCH --output serial_test_%j.log</code>. Thus the output for this job
with be in the file <code class="language-plaintext highlighter-rouge">serial_test_&lt;jobid&gt;.log</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">ls</span>
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>serial_test_&lt;jobid&gt;.log     slurm.sh
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">cat </span>serial_test_&lt;jobid&gt;.log
</code></pre></div></div>

<div class="language-plaintext output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Tue Sep 15 02:04:05 EDT 2020
Tue Sep 15 02:04:15 EDT 2020
Tue Sep 15 02:04:25 EDT 2020
Tue Sep 15 02:04:35 EDT 2020
Tue Sep 15 02:04:45 EDT 2020
Tue Sep 15 02:04:55 EDT 2020
</code></pre></div></div>

<blockquote class="tips">
  <h2 id="autocomplete-in-terminal">Autocomplete in terminal</h2>
  <p>To autocomplete a file or directory name, press <kbd>Tab</kbd> button. 
Names are autocompleted until there are conflicts (e.g. files with same prefixes).
In case of conflict, press tab two time to view list of files and folders (equivalent to <code class="language-plaintext highlighter-rouge">ls</code>).
To try autocomplete, type <code class="language-plaintext highlighter-rouge">cat se</code> and press <kbd>Tab</kbd>.</p>
</blockquote>





<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Don’t forget to edit the memory, CPU requested, and email in the SLURM request.</p>
</li>
    
    <li><p>The job we submit here is a single thread. There are several other ways to submit the job. Multithreaded, Hybrid, GPU, and array scripts request resources depending on the job you are running.</p>
</li>
    
  </ul>
</blockquote>

</article>



























  
  
















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../01-unix/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../03-blast/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      
<footer>
  <hr/>
  <div class="row">
    <div class="col-md-6" align="left">
      <h4>
	      Copyright &copy; 2020–2022 <a href="https://github.com/BioInfoAPS">APS Basic Bioinformatics Workshop Team</a>
    </div>
  </div>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>

<script>
/* Based on https://stackoverflow.com/a/30894829/1802726 */
var show_instructions = function() {
     //set all nav tabs to inactive
    $('.nav-tabs li').removeClass('active');

    //get all nav tabs matching the os and set to active
    $('.nav-tabs li a[href*="'+localStorage.os+'"]').closest('li').addClass('active');

    //set all tabs to inactive
    $('.tab-pane').removeClass('active');

    //get all tabs matching the os and set to active
    $('.tab-pane[id*="'+localStorage.os+'"]').addClass('active');
}

if (typeof(Storage) !== "undefined") {
    if (localStorage.os == "undefined") {
        localStorage.os = "windows";
    }
    show_instructions();
} else {
    console.log("No localStorage");
}

/* Based on https://stackoverflow.com/a/30894829/1802726 */
$('.nav-tabs li a').click(function(){
    //get selected os
    localStorage.os = $(this)[0].dataset.os;
    show_instructions();
});

  // detect misssing iframe for Eventbrite
  $(document).ready(function(){
      if ($('iframe').height() == 0) {
          $('iframe').before('<p>Looks like your adblocker blocked the registration window. Please navigate to <a href="https://www.eventbrite.com/tickets-external?eid=&ref=etckt">https://www.eventbrite.com/tickets-external?eid=&ref=etckt</a> to register.</p>');
      }
  });

  // hide alerts when site is rendered on carpentries.github.io
  $(document).ready(function() {
      if (location.href.startsWith("https://carpentries.github.io/workshop-template/")) {
          $("div.alert").hide();
      }
  });

</script>

  </body>
</html>
